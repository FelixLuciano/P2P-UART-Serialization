import sys
import os
import unittest

sys.path.append(os.path.join('src'))

from lib.package import Package


class TestPackage (unittest.TestCase):
    def test_encode (self):
        """Tests if Package can encode 'Hello World!' properly.
        """
        package = Package('Hello World!', 'response')
        result = b''.join(package.encode())
        expected = b'\xb7\x01\x00\x06\x02\x00\x00\x00\x00\x00He\xdbf\x99\xdb\xb7\x01\x01\x06\x02\x00\x00\x00\x00\x00ll\xdbf\x99\xdb\xb7\x01\x02\x06\x02\x00\x00\x00\x00\x00o \xdbf\x99\xdb\xb7\x01\x03\x06\x02\x00\x00\x00\x00\x00Wo\xdbf\x99\xdb\xb7\x01\x04\x06\x02\x00\x00\x00\x00\x00rl\xdbf\x99\xdb\xb7\x01\x05\x06\x02\x00\x00\x00\x00\x00d!\xdbf\x99\xdb'
        
        self.assertEqual(result, expected, msg="Hello World!")

    def test_decode (self):
        """Tests if Package can decode a package properly.
        """
        package = [b'\xb7\x01\x00\x06\x02\x00\x00\x00\x00\x00He\xdbf\x99\xdb', b'\xb7\x01\x01\x06\x02\x00\x00\x00\x00\x00ll\xdbf\x99\xdb', b'\xb7\x01\x02\x06\x02\x00\x00\x00\x00\x00o \xdbf\x99\xdb', b'\xb7\x01\x03\x06\x02\x00\x00\x00\x00\x00Wo\xdbf\x99\xdb', b'\xb7\x01\x04\x06\x02\x00\x00\x00\x00\x00rl\xdbf\x99\xdb', b'\xb7\x01\x05\x06\x02\x00\x00\x00\x00\x00d!\xdbf\x99\xdb']
        result = b''.join(map(Package.decode, package))
        expected = b'Hello World!'
        
        self.assertEqual(result, expected, msg="Hello World!")


if __name__ == '__main__':
    unittest.main()
